<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>DAQlml: main.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>main.cpp</h1><a href="main_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*Additional documentation for the generation of the reference page (using doxygen)*/</span>
<a name="l00088"></a>00088 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00089"></a>00089 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00090"></a>00090 <span class="preprocessor">#include &lt;sys/mman.h&gt;</span>
<a name="l00091"></a>00091 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00092"></a>00092 <span class="preprocessor">#include &lt;iomanip&gt;</span>
<a name="l00093"></a>00093 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00094"></a>00094 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00095"></a>00095 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="comment">//debug macro</span>
<a name="l00098"></a><a class="code" href="main_8cpp.html#aea1ac050c1347d4a67f85cbfc88ec8cf">00098</a> <span class="preprocessor">#define PR(value) std::cerr&lt;&lt;#value&lt;&lt;&quot;=&quot;&lt;&lt;value&lt;&lt;std::endl&lt;&lt;std::flush;</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span>
<a name="l00100"></a>00100 <span class="comment">//comedi library</span>
<a name="l00101"></a>00101 <span class="preprocessor">#include &lt;comedilib.h&gt;</span>
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="comment">//NetCDF library and extensions</span>
<a name="l00104"></a>00104 <span class="preprocessor">#include &lt;netcdfcpp.h&gt;</span>
<a name="l00105"></a>00105 <span class="preprocessor">#include &quot;../NetCDF.Tool/struct_parameter_NetCDF.h&quot;</span>
<a name="l00106"></a>00106 <span class="preprocessor">#include &quot;../NetCDF.Tool/NetCDFinfo.h&quot;</span>
<a name="l00107"></a>00107 <span class="preprocessor">#include &quot;../CImg.Tool/CImg_NetCDF.h&quot;</span>
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="comment">// real time headers</span>
<a name="l00110"></a>00110 <span class="comment">//#ifdef REAL_TIME</span>
<a name="l00111"></a>00111 <span class="preprocessor">#include &quot;../RealTime/RT_PREEMPT.h&quot;</span>
<a name="l00112"></a>00112 <span class="comment">//#endif</span>
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">//DAQlml headers</span>
<a name="l00115"></a>00115 <span class="preprocessor">#include &quot;<a class="code" href="DAQcomedi_8h.html">DAQcomedi.h</a>&quot;</span>
<a name="l00116"></a>00116 <span class="preprocessor">#include &quot;<a class="code" href="DAQdata_8h.html">DAQdata.h</a>&quot;</span>
<a name="l00117"></a>00117 <span class="preprocessor">#include &quot;<a class="code" href="DAQloop_8h.html">DAQloop.h</a>&quot;</span>
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="comment">//process headers</span>
<a name="l00121"></a>00121 <span class="preprocessor">#include &quot;<a class="code" href="acquisition_8h.html">acquisition.h</a>&quot;</span>
<a name="l00122"></a>00122 <span class="preprocessor">#include &quot;<a class="code" href="control_8h.html">control.h</a>&quot;</span>
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <span class="comment">//test signal</span>
<a name="l00125"></a>00125 <span class="preprocessor">#include &quot;<a class="code" href="DAQtest_8h.html">DAQtest.h</a>&quot;</span>
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 <span class="comment">//signal post-processing</span>
<a name="l00129"></a>00129 <span class="comment"></span><span class="comment">//#include &quot;statistic.h&quot;</span>
<a name="l00130"></a>00130 <span class="comment">//#include &quot;histogram.h&quot;</span>
<a name="l00131"></a>00131 
<a name="l00133"></a>00133 
<a name="l00145"></a><a class="code" href="main_8cpp.html#aa326249c9a81baccaf98b1e3c9ce79b6">00145</a> <span class="keywordtype">double</span> <a class="code" href="main_8cpp.html#aa326249c9a81baccaf98b1e3c9ce79b6">getETime</a>()
<a name="l00146"></a>00146 {
<a name="l00147"></a>00147   <span class="keyword">struct </span>timeval tv;
<a name="l00148"></a>00148   gettimeofday(&amp;tv, NULL);
<a name="l00149"></a>00149   <span class="keywordflow">return</span> tv.tv_sec + (double)tv.tv_usec*1e-6;
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 
<a name="l00153"></a>00153 
<a name="l00157"></a><a class="code" href="main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">00157</a> <span class="keywordtype">int</span> <a class="code" href="main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97" title="main function of the DAQlml program">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159   <span class="keyword">const</span> std::string version = <span class="stringliteral">&quot;DAQlml v0.4.4: DAta AcQuisition program of LML&quot;</span>;
<a name="l00160"></a>00160                                
<a name="l00161"></a>00161   std::cout&lt;&lt;<span class="stringliteral">&quot;----------------------------------------------&quot;</span>&lt;&lt;std::endl;
<a name="l00162"></a>00162   std::cout&lt;&lt; version                                        &lt;&lt;std::endl;
<a name="l00163"></a>00163   std::cout&lt;&lt;<span class="stringliteral">&quot;----------------------------------------------&quot;</span>&lt;&lt;std::endl;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   cimg_usage(version.c_str()); 
<a name="l00167"></a>00167   <span class="comment">//both declare and get parameters for command line options</span>
<a name="l00168"></a>00168   <span class="keyword">const</span> <span class="keywordtype">int</span>  verbose    = (cimg_option(<span class="stringliteral">&quot;-v&quot;</span>,(<span class="keyword">const</span> <span class="keywordtype">char</span>*)NULL,<span class="stringliteral">&quot;verbose option&quot;</span>)!=NULL);
<a name="l00169"></a>00169   <span class="keyword">const</span> <span class="keywordtype">bool</span> show_info  = (cimg_option(<span class="stringliteral">&quot;--info&quot;</span>,(<span class="keyword">const</span> <span class="keywordtype">char</span>*)NULL,<span class="stringliteral">&quot;information&quot;</span>)!=NULL);
<a name="l00170"></a>00170   <span class="keyword">const</span> <span class="keywordtype">bool</span> show_h     = (cimg_option(<span class="stringliteral">&quot;-h&quot;</span>,(<span class="keyword">const</span> <span class="keywordtype">char</span>*)NULL,NULL)!=NULL);
<a name="l00171"></a>00171         <span class="keywordtype">bool</span> show_help  = (cimg_option(<span class="stringliteral">&quot;--help&quot;</span>,(<span class="keyword">const</span> <span class="keywordtype">char</span>*)NULL,<span class="stringliteral">&quot;help (or -h option)&quot;</span>)!=NULL);show_help=show_h|show_help;
<a name="l00172"></a>00172 
<a name="l00174"></a>00174   <span class="keyword">const</span> std::string fd  =  cimg_option(<span class="stringliteral">&quot;--fd&quot;</span>,<span class="stringliteral">&quot;/dev/comedi0&quot;</span>,<span class="stringliteral">&quot;board device file&quot;</span>);
<a name="l00175"></a>00175   <span class="keyword">const</span> std::string fp  =  cimg_option(<span class="stringliteral">&quot;--fp&quot;</span>,<span class="stringliteral">&quot;parameters.nc&quot;</span>,<span class="stringliteral">&quot;input parameter file&quot;</span>);
<a name="l00176"></a>00176 <span class="comment">//  const std::string fi  =  cimg_option(&quot;--fi&quot;,&quot;&quot;,&quot;input data file&quot;);</span>
<a name="l00177"></a>00177   <span class="keyword">const</span> std::string fo  =  cimg_option(<span class="stringliteral">&quot;--fo&quot;</span>,<span class="stringliteral">&quot;data.nc&quot;</span>,<span class="stringliteral">&quot;output data file&quot;</span>);
<a name="l00178"></a>00178 <span class="comment">//  const std::string fs  =  cimg_option(&quot;--fs&quot;,&quot;stats.nc&quot;,&quot;statistics output file&quot;);</span>
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 
<a name="l00183"></a>00183 <span class="comment">//  bool       acquire   =  fi.empty();</span>
<a name="l00184"></a>00184   <span class="keyword">const</span> <span class="keywordtype">bool</span> time_axis =  cimg_option(<span class="stringliteral">&quot;-t&quot;</span>,<span class="keyword">true</span>,<span class="stringliteral">&quot;create time axis&quot;</span>);
<a name="l00185"></a>00185   <span class="keywordtype">bool</span>       conv_phys =  cimg_option(<span class="stringliteral">&quot;-c&quot;</span>,<span class="keyword">true</span>,<span class="stringliteral">&quot;convert 16bit int value into voltage&quot;</span>);
<a name="l00186"></a>00186   <span class="keyword">const</span> <span class="keywordtype">int</span>  test      =  cimg_option(<span class="stringliteral">&quot;--test&quot;</span>,0,<span class="stringliteral">&quot;test, 0: no test, 1: square wave test&quot;</span>);<span class="comment">//, 2: sin wave test&quot;);</span>
<a name="l00187"></a>00187 <span class="comment">//  const bool control   =  cimg_option(&quot;--control&quot;,false,&quot;use of output for control&quot;);</span>
<a name="l00188"></a>00188   <span class="keyword">const</span> <span class="keywordtype">bool</span> bdinfo    = (cimg_option(<span class="stringliteral">&quot;--boardinfo&quot;</span>,(<span class="keyword">const</span> <span class="keywordtype">char</span>*)NULL,<span class="stringliteral">&quot;print board info&quot;</span>)!=NULL);
<a name="l00189"></a>00189   <span class="keyword">const</span> <span class="keywordtype">int</span>  show      = (cimg_option(<span class="stringliteral">&quot;--show&quot;</span>,0,<span class="stringliteral">&quot;display result as a graph, 0: no display 1: data (and histogram on test) 2: + errors 3: + raw data/clean data&quot;</span>));
<a name="l00190"></a>00190   <span class="keyword">const</span> <span class="keywordtype">bool</span> buffer  =  cimg_option(<span class="stringliteral">&quot;--buffer&quot;</span>, <span class="keyword">false</span>,<span class="stringliteral">&quot;acquisition type&quot;</span>);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192   <span class="comment">//show help and/or information</span>
<a name="l00193"></a>00193   <span class="keywordflow">if</span>(show_help) {<a class="code" href="DAQcomedi_8h.html#addae8256b5ffd39689f2d7f22d49d470" title="display help options">print_help</a>(std::cerr);      <span class="keywordflow">return</span> 0;}
<a name="l00194"></a>00194   <span class="keywordflow">if</span>(show_info) {cimg::info();               <span class="keywordflow">return</span> 0;}
<a name="l00195"></a>00195   <span class="keywordflow">if</span>(bdinfo)    {<a class="code" href="DAQcomedi_8h.html#af2c0183de36a27d1df7a6adbb533bdea">get_board_info</a>(fd, bdinfo); <span class="keywordflow">return</span> 0;}
<a name="l00196"></a>00196   
<a name="l00197"></a>00197   <span class="comment">//variables for test</span>
<a name="l00198"></a>00198   <a class="code" href="classDAQtest.html" title="test device">DAQtest</a> DAQt;
<a name="l00199"></a>00199   
<a name="l00200"></a>00200   <span class="keywordflow">if</span>(test==<a class="code" href="DAQtest_8h.html#a6948aaa0af2f228a2d9467c84ecb6012">TEST_SQWAVE</a>)  DAQt.<a class="code" href="classDAQtest.html#af5a47374a191542830f1e992f55bb397" title="Print instructions depending of the type of signal we want to test (sinus,square...">test_print_instruction</a>(<a class="code" href="DAQtest_8h.html#a6948aaa0af2f228a2d9467c84ecb6012">TEST_SQWAVE</a>);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <span class="comment">// create DAQdevice;</span>
<a name="l00203"></a>00203   <a class="code" href="classDAQdevice.html" title="acquisition device">DAQdevice</a> DAQdev(fd);
<a name="l00204"></a>00204   std::cout&lt;&lt;<span class="stringliteral">&quot;loading sampling parameters from &apos;&quot;</span>&lt;&lt; fp &lt;&lt;<span class="stringliteral">&quot;&apos;.&quot;</span>&lt;&lt;std::endl;
<a name="l00205"></a>00205   DAQdev.<a class="code" href="classDAQdevice.html#a9b26a696d9fbd13ca1496a785dcaa322" title="load acquisition parameter from file">load_parameter</a>(fp);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="keywordtype">void</span> *map;<span class="comment">// pointer to mapped memory</span>
<a name="l00208"></a>00208   DAQdev.<a class="code" href="classDAQdevice.html#a15fe213299304d00edabbcb70a9292a8">verbose</a>=verbose;
<a name="l00209"></a>00209   <span class="comment">//initialize acquisition device</span>
<a name="l00210"></a>00210   <span class="keywordflow">if</span>(buffer)
<a name="l00211"></a>00211   {
<a name="l00212"></a>00212     DAQdev.<a class="code" href="classDAQdevice.html#a3b31c44b3ee78861ab359848016492cd">config_device_buffer</a>(map);
<a name="l00213"></a>00213   }
<a name="l00214"></a>00214   <span class="keywordflow">else</span>
<a name="l00215"></a>00215   {
<a name="l00216"></a>00216     <span class="comment">//DAQdev.sampling_rate = 1/(DEMIPERIOD*pow(10,-9));</span>
<a name="l00217"></a>00217  <span class="comment">//std::cout &lt;&lt; &quot;\n resultat &quot; &lt;&lt;1/(DEMIPERIOD*pow(10,-9))&lt;&lt; &quot;\n&quot;;</span>
<a name="l00218"></a>00218         
<a name="l00219"></a>00219     DAQdev.<a class="code" href="classDAQdevice.html#ac264c9ba4757f3e479f14b2c7cc3405a">config_device_point</a>();
<a name="l00220"></a>00220   }
<a name="l00221"></a>00221   DAQdev.<a class="code" href="classDAQdevice.html#ab530a8a636f70bf89d69871d9aa1be0b" title="print on given stream all member values">print</a>();
<a name="l00222"></a>00222 
<a name="l00224"></a>00224   std::cout&lt;&lt;<span class="stringliteral">&quot;allocating memory for data.&quot;</span>&lt;&lt;std::endl;
<a name="l00225"></a>00225   <span class="keywordtype">double</span> st, en;
<a name="l00226"></a>00226   st=<a class="code" href="main_8cpp.html#aa326249c9a81baccaf98b1e3c9ce79b6">getETime</a>();
<a name="l00227"></a>00227   cimg_library::CImgList&lt;int&gt;   data(DAQdev.<a class="code" href="classDAQdevice.html#a520e774eb72264c91bb29985eb4dee5a" title="channel index">channel_index</a>.size(),DAQdev.<a class="code" href="classDAQdevice.html#a205c8e14f239e5e5f837145642395f01" title="sample number">sample_number</a>);
<a name="l00228"></a>00228   cimg_library::CImgList&lt;float&gt; data_phys;
<a name="l00229"></a>00229   cimg_library::CImgList&lt;float&gt; time;
<a name="l00230"></a>00230   en=<a class="code" href="main_8cpp.html#aa326249c9a81baccaf98b1e3c9ce79b6">getETime</a>();
<a name="l00231"></a>00231   std::cout&lt;&lt;<span class="stringliteral">&quot;elapsed time: &quot;</span>&lt;&lt;(en-st)&lt;&lt;<span class="stringliteral">&quot; sec&quot;</span>&lt;&lt;std::endl;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="comment">//RT</span>
<a name="l00234"></a>00234  <span class="comment">// data.fill(99);</span>
<a name="l00235"></a>00235   <span class="comment">//RT.init</span>
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   <span class="comment">//control or acquisition loop</span>
<a name="l00238"></a>00238   std::cout&lt;&lt;<span class="stringliteral">&quot;starting sampling with &quot;</span>;
<a name="l00239"></a>00239   st=<a class="code" href="main_8cpp.html#aa326249c9a81baccaf98b1e3c9ce79b6">getETime</a>();
<a name="l00241"></a>00241   <span class="keywordflow">if</span>(buffer) <a class="code" href="DAQloop_8h.html#a51856b530a4479d0810e70d396e5682c" title="read the data from the mapped buffer">sample_data_buffer</a>(data, map, DAQdev);<span class="comment">//,control);</span>
<a name="l00242"></a>00242   <span class="keywordflow">else</span> <a class="code" href="DAQloop_8h.html#a5d166b9d5811cdca286ca56f0f4d6c05">sample_data_point</a>(data, DAQdev);<span class="comment">//,control);</span>
<a name="l00243"></a>00243   en=<a class="code" href="main_8cpp.html#aa326249c9a81baccaf98b1e3c9ce79b6">getETime</a>();
<a name="l00244"></a>00244   std::cout&lt;&lt;<span class="stringliteral">&quot;elapsed time: &quot;</span>&lt;&lt;(en-st)&lt;&lt;<span class="stringliteral">&quot; sec&quot;</span>&lt;&lt;std::endl;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <span class="comment">//convert data to data_phys</span>
<a name="l00247"></a>00247   <span class="keywordflow">if</span>(conv_phys) {
<a name="l00248"></a>00248     st=<a class="code" href="main_8cpp.html#aa326249c9a81baccaf98b1e3c9ce79b6">getETime</a>();
<a name="l00249"></a>00249     std::cout&lt;&lt;<span class="stringliteral">&quot;converting binary data to physical voltage.&quot;</span>&lt;&lt;std::endl;
<a name="l00250"></a>00250     <a class="code" href="DAQcomedi_8h.html#a632df68c252dc93c09a782c0d12c7c49" title="convert integer 16bit binary data into float physical voltage">convert_to_phys</a>(data, data_phys, DAQdev);
<a name="l00251"></a>00251 data.print(<span class="stringliteral">&quot;data in main&quot;</span>);
<a name="l00252"></a>00252 data_phys.print(<span class="stringliteral">&quot;data_phys in main&quot;</span>);
<a name="l00253"></a>00253     en=<a class="code" href="main_8cpp.html#aa326249c9a81baccaf98b1e3c9ce79b6">getETime</a>();
<a name="l00254"></a>00254     std::cout&lt;&lt;<span class="stringliteral">&quot;elapsed time: &quot;</span>&lt;&lt;(en-st)&lt;&lt;<span class="stringliteral">&quot; sec&quot;</span>&lt;&lt;std::endl;
<a name="l00255"></a>00255   }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257   <span class="comment">//create time axis</span>
<a name="l00258"></a>00258   <span class="keywordflow">if</span>(time_axis)
<a name="l00259"></a>00259     {
<a name="l00260"></a>00260       st=<a class="code" href="main_8cpp.html#aa326249c9a81baccaf98b1e3c9ce79b6">getETime</a>();
<a name="l00261"></a>00261       std::cout&lt;&lt;<span class="stringliteral">&quot;creating time axis.&quot;</span>&lt;&lt;std::endl;
<a name="l00262"></a>00262       <a class="code" href="DAQcomedi_8h.html#a910715a21330e06e609349c6161a6e82" title="create time corresponding to each sample">create_time</a>(data, time, DAQdev);
<a name="l00263"></a>00263       en=<a class="code" href="main_8cpp.html#aa326249c9a81baccaf98b1e3c9ce79b6">getETime</a>();
<a name="l00264"></a>00264       std::cout&lt;&lt;<span class="stringliteral">&quot;elapsed time: &quot;</span>&lt;&lt;(en-st)&lt;&lt;<span class="stringliteral">&quot; sec&quot;</span>&lt;&lt;std::endl;
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266   <span class="keywordflow">if</span>(verbose) data_phys.print(<span class="stringliteral">&quot;data physical&quot;</span>);
<a name="l00267"></a>00267 
<a name="l00268"></a>00268   std::cout&lt;&lt;<span class="stringliteral">&quot;printing first 10 samples.&quot;</span>&lt;&lt;std::endl;
<a name="l00269"></a>00269   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;10; j++){<span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;DAQdev.<a class="code" href="classDAQdevice.html#a520e774eb72264c91bb29985eb4dee5a" title="channel index">channel_index</a>.size(); i++){ <span class="keywordflow">if</span>(data_phys[i](j)&gt;=0.0){std::cout&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;} std::cout&lt;&lt;std::scientific&lt;&lt;std::setprecision(3)&lt;&lt;data_phys[i](j)&lt;&lt;<span class="stringliteral">&quot; &quot;</span>; } std::cout&lt;&lt;std::endl; }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271   <span class="comment">//check simple statistics, mean, var, min, max</span>
<a name="l00272"></a>00272   std::cout&lt;&lt;<span class="stringliteral">&quot;computing basic statistics.&quot;</span>&lt;&lt;std::endl;
<a name="l00273"></a>00273   cimglist_for(data_phys,n){std::cout&lt;&lt;<span class="stringliteral">&quot;chan-&quot;</span>&lt;&lt;DAQdev.<a class="code" href="classDAQdevice.html#a520e774eb72264c91bb29985eb4dee5a" title="channel index">channel_index</a>[n] &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; DAQdev.<a class="code" href="classDAQdevice.html#a7ab11417ddb59db3b66c0292dd5cc4ab" title="channel name">channel_name</a>[n] &lt;&lt; <span class="stringliteral">&quot;, mean: &quot;</span>&lt;&lt;data_phys[n].mean() &lt;&lt; <span class="stringliteral">&quot;, min: &quot;</span>&lt;&lt;data_phys[n].min()&lt;&lt;<span class="stringliteral">&quot;, max: &quot;</span>&lt;&lt;data_phys[n].max()&lt;&lt;<span class="stringliteral">&quot;, var: &quot;</span>&lt;&lt;data_phys[n].variance()&lt;&lt;std::endl;}
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 
<a name="l00277"></a>00277   <span class="keywordflow">if</span>(test==<a class="code" href="DAQtest_8h.html#a6948aaa0af2f228a2d9467c84ecb6012">TEST_SQWAVE</a>)
<a name="l00278"></a>00278     {
<a name="l00279"></a>00279       std::cout&lt;&lt;<span class="stringliteral">&quot;testing signals by square wave.&quot;</span>&lt;&lt;std::endl;  
<a name="l00280"></a>00280 
<a name="l00281"></a>00281       DAQt.<a class="code" href="classDAQtest.html#a3642710a6eb95291cda80472dc65c03a">load_parameter</a>(fp);
<a name="l00283"></a>00283       <span class="comment">/*</span>
<a name="l00284"></a>00284 <span class="comment">      for(i=0;i&lt;data_phys.size();i++)</span>
<a name="l00285"></a>00285 <span class="comment">        {</span>
<a name="l00286"></a>00286 <span class="comment">          DAQt.test_signal(data_phys[i],DAQdev.sampling_rate,true,false,true,DAQt.reference_frequency,DAQt.reference_DC,DAQt.reference_tolerance);</span>
<a name="l00287"></a>00287 <span class="comment">        }</span>
<a name="l00288"></a>00288 <span class="comment">      */</span>
<a name="l00289"></a>00289       DAQt.<a class="code" href="classDAQtest.html#a9791c3ea892ab788a168e05a8a7af62b" title="test for TTL (i.e. square signal)">test_signal</a>(data_phys[0],DAQdev.<a class="code" href="classDAQdevice.html#aa68427268fa850154def25e7f729bb02" title="sampling rate">sampling_rate</a>,DAQt.<a class="code" href="classDAQtest.html#a99c58db38659ad7f6e7f3281d9dea99d">gaussian_filter</a>,DAQt.<a class="code" href="classDAQtest.html#a4265693e785c4162857b6c376db2e57b">DCfrequency</a>,show,DAQt.<a class="code" href="classDAQtest.html#ab2cd889ed37f243b4e3773bd60896d7b">reference_frequency</a>,DAQt.<a class="code" href="classDAQtest.html#ace06c08db7f86309dc624931719fdde0">reference_DC</a>,DAQt.<a class="code" href="classDAQtest.html#af26c6c5441ea93d74bfff8bb03870555">reference_tolerance</a>);     
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291   
<a name="l00292"></a>00292   std::cout&lt;&lt;<span class="stringliteral">&quot;saving data into a NetCDF file.&quot;</span>&lt;&lt;std::endl;
<a name="l00293"></a>00293   st=<a class="code" href="main_8cpp.html#aa326249c9a81baccaf98b1e3c9ce79b6">getETime</a>();
<a name="l00294"></a>00294   <span class="keywordtype">int</span> acqu_range_min=0,acqu_range_max=DAQdev.<a class="code" href="classDAQdevice.html#a8b716a595d0eb01f6ecbc24d1be1cdc1" title="max value of voltage">maxdata</a>;std::string acqu_range_unit(<span class="stringliteral">&quot;level&quot;</span>);
<a name="l00295"></a>00295   <span class="keywordflow">if</span>(conv_phys)
<a name="l00296"></a>00296     {
<a name="l00297"></a>00297       <span class="keywordtype">float</span> phys_range_min=DAQdev.<a class="code" href="classDAQdevice.html#ad190f0c7cbfb6aa3b0bf1ae7f88c81db" title="pointer to comedirange;">comedirange</a>-&gt;min,phys_range_max=DAQdev.<a class="code" href="classDAQdevice.html#ad190f0c7cbfb6aa3b0bf1ae7f88c81db" title="pointer to comedirange;">comedirange</a>-&gt;max; std::string phys_range_unit(<span class="stringliteral">&quot;volt&quot;</span>);
<a name="l00298"></a>00298       <a class="code" href="DAQdata_8h.html#a111851b62bd0fbd982f5c7e6f7b5715c" title="save recorded data and additional informations">save_data</a>(fo, data_phys, time, DAQdev, <span class="stringliteral">&quot;volt&quot;</span>, acqu_range_min, acqu_range_max, acqu_range_unit, phys_range_min, phys_range_max, phys_range_unit);
<a name="l00299"></a>00299     }
<a name="l00300"></a>00300   <span class="keywordflow">else</span>
<a name="l00301"></a>00301     {
<a name="l00302"></a>00302       <span class="keywordtype">int</span>   phys_range_min=DAQdev.<a class="code" href="classDAQdevice.html#ad190f0c7cbfb6aa3b0bf1ae7f88c81db" title="pointer to comedirange;">comedirange</a>-&gt;min,phys_range_max=DAQdev.<a class="code" href="classDAQdevice.html#ad190f0c7cbfb6aa3b0bf1ae7f88c81db" title="pointer to comedirange;">comedirange</a>-&gt;max; std::string phys_range_unit(<span class="stringliteral">&quot;volt&quot;</span>);
<a name="l00303"></a>00303       <a class="code" href="DAQdata_8h.html#a111851b62bd0fbd982f5c7e6f7b5715c" title="save recorded data and additional informations">save_data</a>(fo, data, time, DAQdev, <span class="stringliteral">&quot;16 bit binary&quot;</span>, acqu_range_min, acqu_range_max, acqu_range_unit, phys_range_min, phys_range_max, phys_range_unit);
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305   en=<a class="code" href="main_8cpp.html#aa326249c9a81baccaf98b1e3c9ce79b6">getETime</a>();
<a name="l00306"></a>00306   std::cout&lt;&lt;<span class="stringliteral">&quot;elapsed time: &quot;</span>&lt;&lt;(en-st)&lt;&lt;<span class="stringliteral">&quot; sec&quot;</span>&lt;&lt;std::endl;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   
<a name="l00309"></a>00309   std::cout&lt;&lt;<span class="stringliteral">&quot;finalizing the device.&quot;</span>&lt;&lt;std::endl;
<a name="l00310"></a>00310   <span class="keywordtype">int</span> ret=comedi_close(DAQdev.<a class="code" href="classDAQdevice.html#a8203af3afcac012d9ff5f22744ac01ce" title="pointer to device">dev</a>);
<a name="l00311"></a>00311   <span class="keywordflow">if</span>(ret&lt;0){
<a name="l00312"></a>00312     comedi_perror(DAQdev.<a class="code" href="classDAQdevice.html#a829efd01d9695e7fc07a96af1cf3d6ec" title="device file name">filename</a>.c_str());
<a name="l00313"></a>00313     exit(1);
<a name="l00314"></a>00314   }
<a name="l00315"></a>00315 
<a name="l00317"></a>00317   <span class="comment">//display data</span>
<a name="l00318"></a>00318   <span class="keywordflow">if</span>(show==1)
<a name="l00319"></a>00319     {
<a name="l00320"></a>00320       <span class="comment">//tranform data as list to display as image</span>
<a name="l00321"></a>00321       cimg_library::CImg&lt;float&gt; display;
<a name="l00322"></a>00322       <span class="keywordflow">if</span>(conv_phys)
<a name="l00323"></a>00323         {<span class="comment">//floating data (i.e. recorded levels in Volts)</span>
<a name="l00324"></a>00324           cimglist_for(data_phys,n) display.append(data_phys[n]);<span class="comment">//concat lines</span>
<a name="l00325"></a>00325           display.assign(data_phys[0].width(),1,1,data_phys.size());<span class="comment">//set right dimensions</span>
<a name="l00326"></a>00326         }
<a name="l00327"></a>00327       <span class="keywordflow">else</span>
<a name="l00328"></a>00328         {<span class="comment">//unsigned interger data (i.e. recorded discrete levels)</span>
<a name="l00329"></a>00329           cimglist_for(data,n) display.append(data[n]);<span class="comment">//concat lines</span>
<a name="l00330"></a>00330           display.assign(data[0].width(),1,1,data.size());<span class="comment">//set right dimensions</span>
<a name="l00331"></a>00331         }
<a name="l00332"></a>00332       <span class="comment">//display as color graphs by set of 3</span>
<a name="l00333"></a>00333       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;display.spectrum();c+=3)
<a name="l00334"></a>00334         {
<a name="l00335"></a>00335           <span class="keywordtype">int</span> c0=c,c1=((c+3)&lt;display.spectrum())?(c+2):(display.spectrum()-1);
<a name="l00336"></a>00336           <a class="code" href="main_8cpp.html#aea1ac050c1347d4a67f85cbfc88ec8cf">PR</a>(c0);<a class="code" href="main_8cpp.html#aea1ac050c1347d4a67f85cbfc88ec8cf">PR</a>(c1);
<a name="l00337"></a>00337           (display.get_shared_channels(c0,c1)).display_graph(<span class="stringliteral">&quot;channels recorded&quot;</span>);
<a name="l00338"></a>00338         }
<a name="l00339"></a>00339     }<span class="comment">//if show</span>
<a name="l00341"></a>00341 <span class="comment"></span>  <span class="comment">/*</span>
<a name="l00342"></a>00342 <span class="comment">  //later</span>
<a name="l00343"></a>00343 <span class="comment">  if(statistic)</span>
<a name="l00344"></a>00344 <span class="comment">  {</span>
<a name="l00345"></a>00345 <span class="comment">  max_min_mean_rms</span>
<a name="l00346"></a>00346 <span class="comment">  histogram</span>
<a name="l00347"></a>00347 <span class="comment">  if(store_statistic)</span>
<a name="l00348"></a>00348 <span class="comment">  if(GUI_statistic)</span>
<a name="l00349"></a>00349 <span class="comment">  }</span>
<a name="l00350"></a>00350 <span class="comment">  */</span>
<a name="l00351"></a>00351 
<a name="l00352"></a>00352   <span class="keywordflow">return</span> 0;
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Oct 31 16:38:27 2012 for DAQlml by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
